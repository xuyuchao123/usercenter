<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xyc.userc.dao.FreezeMapper">

    <select id="selectCarNumFrozenVo" resultType="com.xyc.userc.vo.CarNumFrozenVo">
        select a.CARNUMBER as carNum, a.FROZEN_STATUS as frozenStatus,
        a.START_DATE as startDate, a.EXPIRE_DATE as expireDate,
        a.VIOLATION_TIMES as violationTimes, a.VIO_HANDLE_STATUS as violationHndStatus,
        a.LAST_VIOLATIONTIME as lastViolationTime
        from SYS_CARNUM_FROZEN a
        <where>
            <if test="carNum != null">
                and a.CARNUMBER = #{carNum}
            </if>
            <if test="frozenStatus != null">
                and a.FROZEN_STATUS = #{frozenStatus}
            </if>
        </where>
    </select>

    <select id="selectCarNumFrozen" resultType="com.xyc.userc.entity.CarNumFrozen">
        select a.ID as id, a.CARNUMBER as carNum, a.FROZEN_STATUS as frozenStatus, a.START_DATE as startDate,
        a.EXPIRE_DATE as expireDate, a.GMT_CREATE as gmtCreate, a.GMT_MODIFIED as gmtModified, a.VIOLATION_TIMES as violationTimes,
        a.VIO_HANDLE_STATUS as violationHndStatus, a.LAST_VIOLATIONTIME as LastViolationTime
        from SYS_CARNUM_FROZEN a
        <where>
            <if test="carNum != null">
                and a.CARNUMBER = #{carNum}
            </if>
            <if test="frozenStatus != null">
                and a.FROZEN_STATUS = #{frozenStatus}
            </if>
        </where>
    </select>

    <select id="selectByCarNums" resultType="com.xyc.userc.entity.CarNumFrozen">
        select DISTINCT a.ID as id, a.CARNUMBER as carNum, a.FROZEN_STATUS as frozenStatus, a.START_DATE as startDate,
        a.EXPIRE_DATE as expireDate, a.GMT_CREATE as gmtCreate, a.GMT_MODIFIED as gmtModified, a.VIOLATION_TIMES as violationTimes,
        a.VIO_HANDLE_STATUS as violationHndStatus, a.LAST_VIOLATIONTIME as LastViolationTime
        from SYS_CARNUM_FROZEN a
        where a.CARNUMBER IN
        <foreach collection="list" open="(" close=")" separator="," item="carNum" index="i">
            #{carNum}
        </foreach>
    </select>

    <update id="updateCarNumFrozens" parameterType="com.xyc.userc.vo.CarNumFrozenAddVo">
        <foreach collection="list" item="carNumFrozenAddVo" index="index" open="begin" close=";end;" separator=";">
        update SYS_CARNUM_FROZEN a set a.FROZEN_STATUS = 1, a.START_DATE = SYSDATE, a.GMT_MODIFIED = SYSDATE,
        a.EXPIRE_DATE = #{carNumFrozenAddVo.expireDate,typeHandler=com.xyc.userc.mybatis.typehandler.LongDateTypeHandler}
        where a.CARNUMBER = #{carNumFrozenAddVo.carNum}
        </foreach>
    </update>

    <update id="updateCarNumUnFrozens">
        <foreach collection="list" item="carNum" index="index" open="begin" close=";end;" separator=";">
            update SYS_CARNUM_FROZEN a set a.FROZEN_STATUS = 0, a.GMT_MODIFIED = SYSDATE, a.EXPIRE_DATE = sysdate
            where a.CARNUMBER = #{carNum}
        </foreach>
    </update>

    <insert id="insertAllCarNumFrozen" parameterType="java.util.List">
        insert all
        <foreach collection="list" separator=" " item="carnumfrozen">
            into SYS_CARNUM_FROZEN (ID,CARNUMBER,FROZEN_STATUS,START_DATE,EXPIRE_DATE,GMT_CREATE,GMT_MODIFIED,VIOLATION_TIMES,
            VIO_HANDLE_STATUS,VIO_HANDLE_STATUS,LAST_VIOLATIONTIME)
            values (get_carnumfrozen_seq,#{carnumfrozen.carNum},#{carnumfrozen.frozenStatus},#{carnumfrozen.startDate},
            #{carnumfrozen.expireDate},#{carnumfrozen.gmtCreate},#{carnumfrozen.gmtModified},#{carnumfrozen.violationTimes},
            #{carnumfrozen.violationHndStatus},#{carnumfrozen.LastViolationTime})
        </foreach>
        select 1 from dual
    </insert>

    <update id="updateAllCarNumFrozen" parameterType="java.util.List">
        <foreach collection="list" item="carnumfrozen" index="index" open="begin" close=";end;" separator=";">
            update SYS_CARNUM_FROZEN set FROZEN_STATUS = #{carnumfrozen.frozenStatus},EXPIRE_DATE = #{carnumfrozen.expireDate},
            GMT_MODIFIED = #{carnumfrozen.gmtModified}, VIOLATION_TIMES = #{carnumfrozen.violationTimes},
            VIO_HANDLE_STATUS = #{carnumfrozen.violationHndStatus}, LAST_VIOLATIONTIME = #{carnumfrozen.LastViolationTime}
            where ID = #{carnumfrozen.id}
        </foreach>
    </update>

</mapper>
